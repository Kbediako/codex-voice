#!/data/data/com.termux/files/usr/bin/sh

VOICE_DIR="$HOME/.codex/device"
PID_FILE="$VOICE_DIR/voice.pid"
NOTIF_VOICE_ID=9101
NOTIF_CTRL_ID=9102

if [ -f "$PID_FILE" ]; then
  pid=$(cat "$PID_FILE" 2>/dev/null)
  if [ -n "$pid" ] && kill -0 "$pid" 2>/dev/null; then
    kill "$pid" >/dev/null 2>&1 || true
    sleep 0.2
  fi
  rm -f "$PID_FILE"
fi

pkill -9 -f "/codex-voice" >/dev/null 2>&1 || true
pkill -9 -f "termux-api SpeechToText" >/dev/null 2>&1 || true
pkill -9 -f "termux-microphone-record" >/dev/null 2>&1 || true

rm -rf "$VOICE_DIR/voice.lock" >/dev/null 2>&1 || true

termux-notification-remove -i "$NOTIF_VOICE_ID" >/dev/null 2>&1 || true
termux-notification-remove -i "$NOTIF_CTRL_ID" >/dev/null 2>&1 || true

termux-toast "Codex voice stopped" >/dev/null 2>&1 || true
