#!/data/data/com.termux/files/usr/bin/sh

HOME_DIR="$HOME"
VOICE_DIR="$HOME_DIR/.codex/device"
PID_FILE="$VOICE_DIR/voice.pid"
NOTIF_ID=9100
TITLE="Codex Voice"
START_BIN="$HOME_DIR/codex-voice/bin/codex-voice-start"
STOP_BIN="$HOME_DIR/codex-voice/bin/codex-voice-stop"

status="stopped"
if [ -f "$PID_FILE" ]; then
  pid=$(cat "$PID_FILE" 2>/dev/null || true)
  if [ -n "$pid" ] && kill -0 "$pid" 2>/dev/null; then
    status="running"
  fi
fi

content="Status: ${status}"\
" | Wake word: yo codex"

start_action="sh -lc '${START_BIN}'"
stop_action="sh -lc '${STOP_BIN}'"

termux-notification -i "$NOTIF_ID" --ongoing --alert-once \
  -t "$TITLE" -c "$content" \
  --button1 "Start" --button1-action "$start_action" \
  --button2 "Stop" --button2-action "$stop_action" \
  --icon "keyboard_voice" >/dev/null 2>&1 || true
